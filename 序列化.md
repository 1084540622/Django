# 序列化

## Serializer 
Serializer 允许复杂数据（比如 querysets 和 model 实例）转换成python数据类型，然后可以更容易的转换成 json 或 xml 等。同时，Serializer也提供了反序列化功能，允许解析数据转换成复杂数据类型。
序列化和反序列化的定义:
将程序中的一个数据结构类型转换为其他格式（字典、JSON、XML等），例如将Django中的模型类对象装换为JSON字符串，这个转换过程我们称为序列化。反之，将其他格式（字典、JSON、XML等）转换为程序中的数据，例如将JSON字符串转换为Django中的模型类对象，这个过程我们称为反序列化。


## 1. 创建Model和数据库迁移
* 创建数据结构模型
在 snippet/models.py 中创建model

        from django.db import models
        from pygments.lexers import get_all_lexers
        from pygments.styles import get_all_styles

        LEXERS = [item for item in get_all_lexers() if item[1]]
        LANGUAGE_CHOICES = sorted([(item[1][0], item[0]) for item in LEXERS])
        STYLE_CHOICES = sorted((item, item) for item in get_all_styles())

        class Snippet(models.Model):
            created = models.DateTimeField(auto_now_add=True)
            # 个人认为官网default与blank重复了，default其实也可以不用写，default默认值就是''。
            title = models.CharField(max_length=100, default='')
            code = models.TextField()
            linenos = models.BooleanField(default=False)
            language = models.CharField(choices=LANGUAGE_CHOICES, default='python', max_length=100)
            style = models.CharField(choices=STYLE_CHOICES, default='friendly', max_length=100)

            class Meta:
                # 通过创建时间获取record
                db_table = 'snippet'
                ordering = ('created',)
            
不用在意pygments相关的代码，不是本文重点（与Drf无关）

* 数据库迁移

> python manage.py makemigrations snippets
> python manage.py migrate


### 字段构造

#### 字段

| 字段 | 字段构造方式 |
|:----|:----:|
|BooleanField|BooleanField()|
|NullBooleanField|NullBooleanField()|
|CharField|CharField(max_length=None, min_length=None, allow_blank=False, trim_whitespace=True)|
|EmailField|EmailField(max_length=None, min_length=None, allow_blank=False)|
|RegexField|RegexField(regex, max_length=None, min_length=None, allow_blank=False)|
|SlugField|SlugField(maxlength=50, min_length=None, allow_blank=False)|
|URLField|URLField(max_length=200, min_length=None, allow_blank=False)|
|UUIDField|UUIDField(format='hex_verbose')|
|IPAddressField|IPAddressField(protocol='both', unpack_ipv4=False, **options)|
|IntegerField|IntegerField(max_value=None, min_value=None)|
|FloatField|FloatField(max_value=None, min_value=None)|
|DecimalField|DecimalField(max_digits, decimal_places, coerce_to_string=None, max_value=None, min_value=None)|
|DateTimeField|DateTimeField(format=api_settings.DATETIME_FORMAT, input_formats=None)|
|DateField|DateField(format=api_settings.DATE_FORMAT, input_formats=None)|
|TimeField|TimeField(format=api_settings.TIME_FORMAT, input_formats=None)|
|DurationField|DurationField()|
|ChoiceField|ChoiceField(choices)|
|MultipleChoiceField|MultipleChoiceField(choices)|
|FileField|FileField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)|
|ImageField|ImageField(max_length=None, allow_empty_file=False, use_url=UPLOADED_FILES_USE_URL)|
|ListField|ListField(child=, min_length=None, max_length=None)|
|DictField|DictField(child=)|

#### 参数

| 参数 | 说明 |
|:----|:----:|
|max_length|最大长度|
|min_lenght|最小长度|
|allow_blank|是否允许为空|
|trim_whitespace|是否截断空白字符|
|max_value|最小值|
|min_value|最大值|
|read_only|表明该字段仅用于序列化输出，默认False|
|write_only|表明该字段仅用于反序列化输入，默认False|
|required|表明该字段在反序列化时必须输入，默认True|
|default|反序列化时使用的默认值|
|allow_null|表明该字段是否允许传入None，默认False|
|validators|该字段使用的验证器|
|error_messages|包含错误编号与错误信息的字典|
|label|用于HTML展示API页面时，显示的字段名称|
|help_text|用于HTML展示API页面时，显示的字段帮助提示信息|

补充一下allow_blank 和allow_null的区别:

null:
If True, Django will store empty values as NULL in the database. Default # 原文解释
is False.
  如果为True，空值将会被存储为NULL，默认为False。
  
blank：
  If True, the field is allowed to be blank. Default is False. # 原文解释
  如果为True，字段允许为空，默认不允许。
  其实感觉没什么区别.
